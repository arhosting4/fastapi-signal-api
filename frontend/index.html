<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ScalpMaster AI - Debug</title>
    <!-- صرف TradingView لائبریری، کوئی Tailwind نہیں -->
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    <style>
        /* سادہ، بنیادی اسٹائل */
        body { font-family: sans-serif; background-color: #111; color: #fff; padding: 20px; }
        #chart-container { width: 100%; height: 400px; margin-top: 20px; }
        #signal-info { margin-top: 20px; border: 1px solid #555; padding: 10px; }
        #error-log { margin-top: 20px; border: 1px solid red; padding: 10px; color: red; }
    </style>
</head>
<body>

    <h1>ScalpMaster AI - Debug Mode</h1>
    
    <div>
        <input type="text" id="symbolInput" placeholder="e.g., EUR/USD" value="XAU/USD">
        <button id="fetchSignalBtn">Fetch Signal</button>
    </div>

    <div id="signal-info">
        <p>Waiting for signal...</p>
    </div>

    <div id="chart-container"></div>

    <div id="error-log">
        <p>No errors yet.</p>
    </div>

    <script>
        // اس بات کو یقینی بنائیں کہ DOM تیار ہے
        document.addEventListener('DOMContentLoaded', () => {
            
            // تمام عناصر کو حاصل کریں
            const symbolInput = document.getElementById('symbolInput');
            const fetchSignalBtn = document.getElementById('fetchSignalBtn');
            const signalInfo = document.getElementById('signal-info');
            const chartContainer = document.getElementById('chart-container');
            const errorLog = document.getElementById('error-log');
            let chart = null;

            // ایرر لاگ کرنے کا فنکشن
            function logError(message) {
                console.error(message);
                errorLog.innerHTML += `<p>${message}</p>`;
            }

            // چارٹ بنانے کا فنکشن
            const createChart = (candleData) => {
                try {
                    if (!candleData || candleData.length === 0) {
                        throw new Error("No candle data received from API.");
                    }

                    chartContainer.innerHTML = ''; // پرانا مواد صاف کریں
                    if (chart) chart.remove();

                    chart = LightweightCharts.createChart(chartContainer, {
                        width: chartContainer.clientWidth,
                        height: 400,
                    });

                    const candleSeries = chart.addCandlestickSeries();
                    const formattedData = candleData.map(d => ({
                        time: new Date(d.datetime + 'Z').getTime() / 1000,
                        open: d.open, high: d.high, low: d.low, close: d.close
                    }));
                    
                    candleSeries.setData(formattedData);
                    signalInfo.innerHTML += '<p style="color: green;">Chart created successfully!</p>';

                } catch (e) {
                    logError(`Chart creation failed: ${e.message}`);
                }
            };

            // سگنل حاصل کرنے کا فنکشن
            const fetchSignal = async () => {
                const symbol = symbolInput.value.trim();
                if (!symbol) {
                    logError("Symbol is empty.");
                    return;
                }

                signalInfo.innerHTML = `<p>Fetching data for ${symbol}...</p>`;
                errorLog.innerHTML = ''; // پرانے ایررز صاف کریں

                try {
                    const response = await fetch(`/signal?symbol=${symbol}&timeframe=5min`);
                    
                    if (!response.ok) {
                        throw new Error(`API request failed with status ${response.status}`);
                    }

                    const data = await response.json();
                    
                    // سگنل کی معلومات دکھائیں
                    signalInfo.innerHTML = `
                        <p>Symbol: ${data.symbol}</p>
                        <p>Signal: ${data.signal}</p>
                        <p>Confidence: ${data.confidence}%</p>
                    `;

                    // چارٹ بنائیں
                    createChart(data.candles);

                } catch (e) {
                    logError(`Fetch failed: ${e.message}`);
                }
            };

            // بٹن پر کلک ایونٹ
            fetchSignalBtn.addEventListener('click', fetchSignal);
        });
    </script>

</body>
</html>
