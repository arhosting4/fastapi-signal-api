<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Market/News Alerts</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { font-family: Arial, sans-serif; background: #151821; color: #e4e6ea;}
        h1 { text-align: center; margin-top: 2rem; }
        #news-panel { max-width: 900px; margin: 2rem auto; background: #202533; border-radius: 7px; border: 1px solid #25304b; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 10px; text-align: left; }
        th { background: #2c3347; }
        tr:nth-child(even) { background: #222232; }
        .impact-high { color: #f7565a; font-weight: bold; }
        .impact-low { color: #7adf82; }
        .source { font-size: 0.93em; color: #6fa9ee;}
        .symbol-tag { background: #333c5f; color: #ffdd63; padding: 2px 8px; border-radius: 3px;}
        .datetime { font-size: 0.84em; color: #b2b6bb;}
        .headline { font-weight: bold; }
    </style>
</head>
<body>
    <h1>ðŸ“¢ Market/News Alerts</h1>
    <div id="news-panel">
        <table>
            <thead>
                <tr>
                    <th>Symbol</th>
                    <th>Impact</th>
                    <th>Headline</th>
                    <th>Source</th>
                    <th>Date/Time</th>
                </tr>
            </thead>
            <tbody id="news-rows"></tbody>
        </table>
    </div>
    <script>
        // Fetch news from REST API (e.g. /api/news-feed)
        async function loadNews() {
            let resp = await fetch("/api/news-feed");
            if (!resp.ok) return;
            let news = await resp.json();
            let rowsHtml = "";
            for (const item of news) {
                const impactClass = (item.impact === "High") ? "impact-high" : "impact-low";
                const src = item.source || "";
                const publishedAt = formatDate(item.published_at);
                rowsHtml += `
                <tr>
                    <td><span class="symbol-tag">${(item.entities && item.entities.length > 0) ? item.entities.join(", ") : "â”€"}</span></td>
                    <td class="${impactClass}">${item.impact}</td>
                    <td class="headline">${escapeText(item.title || "")}</td>
                    <td class="source">${src}</td>
                    <td class="datetime">${publishedAt}</td>
                </tr>`;
            }
            document.getElementById("news-rows").innerHTML = rowsHtml;
        }
        function formatDate(dt) {
            if (!dt) return '';
            if (typeof dt === 'string')
                return dt.replace('T',' ').replace('Z','').split('.')[0];
            return dt;
        }
        function escapeText(text) {
            // Prevent XSS â€” Simple HTML escape
            return (text || '').replace(/</g,"&lt;").replace(/>/g,"&gt;")
        }
        window.onload = loadNews;
    </script>
</body>
</html>
